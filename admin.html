
Hi Claude! Could you build an app based on my idea? If you need more information from me, ask me 1-2 key questions right away. If you think I should upload any documents that would help you do a better job, let me know. You can use the tools you have access to — like Google Drive, web search, etc. — if they’ll help you better accomplish this task. Do not use analysis tool. Please keep your responses friendly, brief and conversational. 
Please execute the task as soon as you can - an artifact would be great if it makes sense. If using an artifact, consider what kind of artifact (interactive, visual, checklist, etc.) might be most helpful for this specific task. Thanks for your help!
Feb 12
I'd love to help you build an app! To get started, I need to understand what you're envisioning:
What should the app do? (What's the main problem it solves or feature it provides?)
Who will use it? (Just you, a team, general public?)
Once I know the basics, I can jump right into building it for you!
Do you want to see my codes and guess?
Feb 12
Yes! That sounds fun. Go ahead and share your codes and I'll try to guess what kind of app you're envisioning. Feel free to upload any files or just paste them here.

<!DOCTYPE html> <html lang="en"> <head> <link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> <link href="https://fonts.googleapis.com/css2?family=Tinos:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="styleshee
PASTED
This is the index:
Feb 12
Ah, I love this! You're building an interactive Istanbul neighborhood news site - like a hyperlocal newspaper where you can click on different districts of Istanbul on a map to see news specific to that neighborhood!
From your code, I can see:
A beautiful newspaper-style layout ("istanbulite.net")
An interactive SVG map of Istanbul with clickable neighborhoods (Bakırköy, Beşiktaş, Kadıköy, etc.)
News articles in sidebars
Navigation to sections like "KAHVEHANE" (coffeehouse - maybe community discussions?) and "KÜTÜPHANE" (library - maybe archives?)
What I think you need help with: Right now the neighborhoods zoom in when clicked but show placeholder text. You probably want to:
Show actual neighborhood-specific news when a district is clicked
Maybe fetch real news or let you manage content for each neighborhood
Quick questions:
Do you want me to build a system where you can add/edit news articles for each neighborhood, or should it pull from somewhere?
Should this be a static site or do you need a backend to manage the content?
I can build you a complete working version with whichever direction you prefer!
Both of those suggestions sound lovely. And about your questions: I want to be the admin of this site, I want to be able to edit the news myself but of course wouldn't show for the users. I want people to log into their accounts before they can click on anything. And your second question: what do you mean static site?
Feb 12
Great! So you want:
User login system (people must sign in to see/click neighborhoods)
Admin panel (where you can add/edit neighborhood news - hidden from regular users)
About static vs backend:
Static site = Just HTML/CSS/JavaScript files, no server. Can't handle logins or save data permanently.
With backend = Has a server + database to store users, articles, handle logins, etc.
Since you need logins and content management, you definitely need a backend!
Here's my plan: I'll build you a complete app with:
User authentication (signup/login required)
Admin panel for you to add/edit neighborhood news
The interactive map that shows your curated news per neighborhood
Database to store everything
One key question: Would you prefer:
A) Full local app (runs on your computer, you'd need to set up hosting later)
B) Modern web app (I'll build it so you can deploy to free hosting like Vercel/Netlify with a simple database)
Which sounds better for your technical comfort level?
Its already on github and i have my domain alive
Feb 17
Perfect! That makes things easier. So you're comfortable with GitHub + deploying to your domain.
Let me ask two quick things before I build:
Q: What's your current hosting setup?
A: GitHub Pages (static only)
Q: For the backend/database, what would you prefer?
A: explain
Feb 17
Sure! Here's a quick breakdown:
Supabase — Free, open-source, has authentication + database built in. Very popular for exactly this kind of site. Works great with GitHub Pages. I'd recommend this.
Firebase (by Google) — Similar, also free tier, also works with GitHub Pages. Slightly more complex to set up.
Something else — Like PlanetScale, Airtable, etc. Not necessary here.
The catch with GitHub Pages: It only serves static files (HTML/CSS/JS). But you can still have logins and a database — the JavaScript on your page talks directly to Supabase/Firebase's servers. No server of your own needed! ✅
My recommendation: Supabase. Here's why:
Free
Has built-in user authentication (login/signup)
Has a database to store your articles per neighborhood
Works perfectly with your existing GitHub Pages + custom domain setup
Has a nice dashboard where you can also manage content directly
My plan would be:
Build you the full updated index.html with login wall + neighborhood news
Build an admin.html page (password-protected, just for you)
Give you step-by-step instructions to connect it to your free Supabase account
Sound good? Want me to go ahead?
yes please
Feb 17
Let me read your code carefully and then build this out!

Reading the frontend design skill for best practices
Reading the frontend design skill for best practices
Now let me build all three files — the main site, admin panel, and setup guide!

Creating the main index.html with Supabase auth + interactive Istanbul map
Creating the main index.html with Supabase auth + interactive Istanbul map
Now the admin panel:

Creating the admin.html panel for managing neighborhood articles
Creating the admin.html panel for managing neighborhood articles
Now the setup guide:

Created a file, read a file
Created a file, read a file
Here's what I built for you! Three files to drop into your GitHub repo:
index.html — Your main site, upgraded with:
A beautiful login wall in your newspaper style (users must sign in to see anything)
The interactive Istanbul map with neighborhood clicks
Articles fetched live from Supabase per district
admin.html — Your private editorial dashboard at /admin.html:
Only accessible with your specific email
Add, edit, delete articles per neighborhood
Filter by district to manage content easily
SETUP.md — Step-by-step guide to connect Supabase (about 10 minutes, all free).
The only things you need to fill in:
YOUR_SUPABASE_URL
YOUR_SUPABASE_ANON_KEY
YOUR_ADMIN_EMAIL
All three are explained in the setup guide! Let me know if you hit any snags.
Index
Code · HTML 
Admin
Code · HTML 
Setup
Document · MD 
Okay so what am I supposed to do now
5:12 AM
Perfect! Here's your action plan:
Right Now:
Go to https://supabase.com and create a free account (takes 2 mins)
Create a new project — name it whatever you want, pick a password, choose EU region
Wait 2 minutes for it to spin up
Then:
Open the SETUP.md file I gave you and follow Step 2 onwards (creating the database table)
Copy your Supabase URL and keys into the two HTML files where it says YOUR_SUPABASE_URL etc.
Push everything to your GitHub (replace your old index.html)
That's it!
Your site will be live at your domain with:
Login required for everyone
You can manage articles at yourdomain.com/admin.html
Want me to walk you through any specific step? Or should I wait while you do the Supabase setup and help if you get stuck?
should I enable data api and automatic RLS
5:15 AM
Good questions!
Data API: Yes, enable it. It's what lets your website talk to the database.
Automatic RLS (Row Level Security): No, turn that OFF. We're setting up custom RLS policies manually (in Step 3 of the setup guide) because we need specific rules — everyone can read articles, but only you can add/edit/delete them.
So:
✅ Data API: ON
❌ Automatic RLS: OFF (we'll do it manually)
Keep going through the setup guide — you're doing great!
Okay I am looking at step 5 and I already have a domain for the website so what should ı DO
5:25 AM
Wait — Step 5 is NOT about domains! Step 5 is about copying your Supabase API keys.
You already have your domain set up (connected to GitHub Pages), so ignore anything about domains. You're golden there! ✅
For Step 5:
In your Supabase dashboard, click Settings (gear icon on the left)
Click API
You'll see:
Project URL (looks like https://xyzabc.supabase.co)
anon public key (long string starting with eyJ...)
Copy both and paste them into your index.html and admin.html files
That's it! Nothing to do with your domain. Your domain stays exactly as it is.
I cant find the project URL, is it the publishable key?
5:26 AM
No! The Project URL is separate from the keys.
In Supabase, when you're in Settings → API, you should see:
Project URL at the very top — looks like https://xyzabc.supabase.co
Then below that, the API Keys section with:
anon key (this is your publishable key)
service_role key
You need:
The Project URL (top section)
The anon key (also called "publishable key")
Can you see the Project URL section at the top? It should be right under the "API" tab heading.
wait.... is it not free if I want to use my own domain, you didnt tell me that :(
5:28 AM
No no no! Your domain is totally separate from Supabase!
You're confusing two different things:
Your website (istanbulite.net) — hosted on GitHub Pages with your domain. Still free! ✅
Supabase — just the backend database. Also free! ✅
Supabase doesn't host your website. It just stores the articles data. Your website files stay on GitHub Pages with your domain exactly as they are now.
The "Project URL" I'm asking for is just the API endpoint so your website can talk to Supabase's database. It has nothing to do with your domain name.
Everything stays free. Your domain works exactly like it does now. We're just adding a free database behind the scenes.
Does that make sense? You're not paying for anything!
I still cant find the project url....
5:29 AM
Okay, let me help you find it step by step:
Are you on the Supabase dashboard? (Should show your project name at the top)
On the left sidebar, scroll down and click the gear icon (Settings)
Under Settings, click API
You should see a page that looks like this:
Project API

Project URL
https://xxxxxxxxx.supabase.co     [copy button]

API Keys
anon public
eyJhbGc...                         [copy button]

service_role secret
eyJhbGc...                         [copy button]
Can you see that "Project URL" section? It should be the first thing on that API page.
If you still don't see it, can you tell me what you DO see on the API settings page?
If I send you them, can you send me the updated index? My email is also cemwozturk@gmail.com
5:31 AM
Yes! Send me:
Your Project URL
Your anon/public key
And I'll update both files with your email and keys, then send them back to you ready to go!
Project URL: https://fgxispjoiynnoqitwpks.supabase.co
Publishable key: sb_publishable_iCNHaPaYLC-WRfmsfNPxYg_x2XJtI9Z
5:31 AM
Perfect! Let me update both files for you with your credentials:

Edited 2 files, read a file
Edited 2 files, read a file
Done! Both files are now updated with your Supabase credentials and email (cemwozturk@gmail.com).
Next steps:
Download these two files
Finish the Supabase setup (Steps 2-4 in SETUP.md — creating the database table and security policies)
Push these files to your GitHub repo
Your site will be live!
The files are ready to go — just need to finish setting up the database table in Supabase first. Let me know when you're on Step 2!
Index
Code · HTML 
Admin
Code · HTML 
Ok I just updated the index, what about the admin one?
5:33 AM
You need to add the admin.html file to your GitHub repo too!
Right now you only have index.html — but you also need admin.html in the same folder so you can access it at yourdomain.com/admin.html
Upload admin.html to your GitHub repo (same place where index.html is), then push/commit.
Both files need to be live for this to work!




Claude is AI and can make mistakes. Please double-check responses.
Admin · HTML
Copy

<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tinos:ital,wght@0,400;0,700;1,400;1,700&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin — istanbulite.net</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --ink: #1a1a18;
      --paper: #f5f0e8;
      --paper-dark: #ede8d8;
      --rule: #2a2a28;
      --accent: #8b0000;
      --muted: #6b6b60;
      --success: #2a6a2a;
      --col-border: 1px solid #2a2a28;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Tinos', Georgia, serif;
      background: var(--paper-dark);
      color: var(--ink);
      min-height: 100vh;
    }

    /* ── ACCESS DENIED / LOGIN ── */
    #access-screen {
      position: fixed;
      inset: 0;
      background: var(--paper);
      z-index: 999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0;
    }

    #access-screen .masthead {
      font-family: 'UnifrakturMaguntia', cursive;
      font-size: 2.8rem;
      color: var(--ink);
      margin-bottom: 4px;
    }

    #access-screen .sub {
      font-size: 0.75rem;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 28px;
    }

    .admin-login-box {
      border: 2px solid var(--ink);
      padding: 32px 38px;
      width: 360px;
      background: var(--paper);
      position: relative;
    }
    .admin-login-box::before {
      content: '';
      position: absolute;
      inset: 4px;
      border: 1px solid var(--ink);
      pointer-events: none;
    }
    .admin-login-box h2 {
      font-size: 0.85rem;
      font-weight: 700;
      letter-spacing: 3px;
      text-transform: uppercase;
      text-align: center;
      margin-bottom: 22px;
      padding-bottom: 12px;
      border-bottom: var(--col-border);
      color: var(--accent);
    }
    .admin-login-box input {
      width: 100%;
      padding: 10px 12px;
      margin-bottom: 12px;
      border: 1px solid var(--ink);
      background: #faf7f0;
      font-family: 'Tinos', serif;
      font-size: 0.95rem;
      color: var(--ink);
      outline: none;
    }
    .admin-login-box input:focus { border-color: var(--accent); }
    .admin-login-box button {
      width: 100%;
      padding: 11px;
      background: var(--accent);
      color: var(--paper);
      border: none;
      font-family: 'Tinos', serif;
      font-size: 0.9rem;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      cursor: pointer;
    }
    .admin-login-box button:hover { background: #6b0000; }
    .error-msg {
      color: var(--accent);
      font-size: 0.82rem;
      text-align: center;
      margin-bottom: 10px;
      min-height: 18px;
      font-style: italic;
    }

    /* ── ADMIN PANEL ── */
    #admin-panel { display: none; }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 32px;
      background: var(--ink);
      color: var(--paper);
      border-bottom: 3px solid var(--accent);
    }

    header h1 {
      font-family: 'UnifrakturMaguntia', cursive;
      font-size: 2rem;
      letter-spacing: 1px;
    }

    header .admin-badge {
      font-size: 0.7rem;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--accent);
      border: 1px solid var(--accent);
      padding: 4px 10px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .header-right span { font-size: 0.78rem; color: #aaa; }

    #signout-btn {
      background: none;
      border: 1px solid #666;
      color: #aaa;
      padding: 5px 12px;
      font-family: 'Tinos', serif;
      font-size: 0.78rem;
      cursor: pointer;
      letter-spacing: 1px;
      transition: all 0.2s;
    }
    #signout-btn:hover { border-color: var(--accent); color: var(--accent); }

    .admin-body {
      display: grid;
      grid-template-columns: 1fr 1.4fr;
      gap: 24px;
      max-width: 1100px;
      margin: 28px auto;
      padding: 0 24px;
    }

    .panel {
      background: var(--paper);
      border: 1px solid var(--ink);
      padding: 24px;
    }

    .panel-title {
      font-size: 0.72rem;
      font-weight: 700;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 18px;
      padding-bottom: 10px;
      border-bottom: var(--col-border);
    }

    label {
      display: block;
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 6px;
      margin-top: 14px;
    }
    label:first-of-type { margin-top: 0; }

    select, input[type="text"], textarea {
      width: 100%;
      padding: 9px 12px;
      border: 1px solid #bbb;
      background: #faf7f0;
      font-family: 'Tinos', serif;
      font-size: 0.92rem;
      color: var(--ink);
      outline: none;
      transition: border-color 0.2s;
    }
    select:focus, input:focus, textarea:focus { border-color: var(--accent); }

    textarea { resize: vertical; min-height: 80px; }

    .btn-row {
      display: flex;
      gap: 10px;
      margin-top: 18px;
    }

    .btn {
      padding: 10px 20px;
      font-family: 'Tinos', serif;
      font-size: 0.85rem;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      cursor: pointer;
      border: none;
      transition: background 0.2s;
    }
    .btn-primary { background: var(--ink); color: var(--paper); flex: 1; }
    .btn-primary:hover { background: var(--accent); }
    .btn-danger { background: #c0392b; color: white; }
    .btn-danger:hover { background: #922b21; }
    .btn-secondary { background: #ddd; color: var(--ink); }
    .btn-secondary:hover { background: #ccc; }

    .status-msg {
      margin-top: 12px;
      font-size: 0.82rem;
      font-style: italic;
      min-height: 18px;
      text-align: center;
    }
    .status-msg.ok { color: var(--success); }
    .status-msg.err { color: var(--accent); }

    /* Articles list */
    .filter-row {
      display: flex;
      gap: 10px;
      margin-bottom: 14px;
      align-items: center;
    }
    .filter-row select { flex: 1; }
    .filter-row button {
      padding: 8px 14px;
      background: var(--ink);
      color: var(--paper);
      border: none;
      font-family: 'Tinos', serif;
      font-size: 0.8rem;
      cursor: pointer;
      letter-spacing: 1px;
    }

    .articles-list { display: flex; flex-direction: column; gap: 10px; max-height: 520px; overflow-y: auto; }

    .article-card {
      border: 1px solid #ccc;
      padding: 12px 14px;
      background: #faf7f0;
      position: relative;
    }

    .article-card .a-neighborhood {
      font-size: 0.65rem;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .article-card h4 {
      font-size: 0.95rem;
      font-weight: 700;
      line-height: 1.3;
      margin-bottom: 4px;
    }

    .article-card p {
      font-size: 0.82rem;
      color: var(--muted);
      line-height: 1.4;
    }

    .article-card .card-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    .card-actions button {
      padding: 4px 12px;
      font-family: 'Tinos', serif;
      font-size: 0.75rem;
      font-weight: 700;
      cursor: pointer;
      letter-spacing: 1px;
      border: none;
    }
    .btn-edit { background: var(--ink); color: var(--paper); }
    .btn-edit:hover { background: #444; }
    .btn-del { background: #c0392b; color: white; }
    .btn-del:hover { background: #922b21; }

    .empty-state {
      font-style: italic;
      color: var(--muted);
      font-size: 0.88rem;
      text-align: center;
      padding: 20px 0;
    }

    .spinner {
      display: inline-block;
      width: 14px; height: 14px;
      border: 2px solid var(--muted);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
      vertical-align: middle;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

<!-- ── ACCESS SCREEN ── -->
<div id="access-screen">
  <div class="masthead">istanbulite.net</div>
  <div class="sub">Admin Access</div>
  <div class="admin-login-box">
    <h2>Editor Login</h2>
    <div class="error-msg" id="access-error"></div>
    <input type="email" id="adm-email" placeholder="Admin email"/>
    <input type="password" id="adm-password" placeholder="Password"/>
    <button id="adm-login-btn">Enter Editorial</button>
  </div>
</div>

<!-- ── ADMIN PANEL ── -->
<div id="admin-panel">
  <header>
    <h1>istanbulite.net</h1>
    <div class="admin-badge">Editorial Desk</div>
    <div class="header-right">
      <span id="adm-email-display"></span>
      <a href="index.html" style="color:#aaa;font-size:0.78rem;text-decoration:none;">← Back to Site</a>
      <button id="signout-btn">Sign Out</button>
    </div>
  </header>

  <div class="admin-body">

    <!-- LEFT: Add / Edit Form -->
    <div class="panel">
      <div class="panel-title" id="form-mode-label">Add New Article</div>

      <label>Neighborhood</label>
      <select id="f-neighborhood">
        <option value="">— Select District —</option>
        <option value="bakirkoy">Bakırköy</option>
        <option value="bayrampasa">Bayrampaşa</option>
        <option value="bahcelievler">Bahçelievler</option>
        <option value="sisli">Şişli</option>
        <option value="eyupsultan">Eyüpsultan</option>
        <option value="gop">Gaziosmanpaşa</option>
        <option value="esenler">Esenler</option>
        <option value="bagcilar">Bağcılar</option>
        <option value="basaksehir">Başakşehir</option>
        <option value="kucukcekmece">Küçükçekmece</option>
        <option value="sultangazi">Sultangazi</option>
        <option value="uskudar">Üsküdar</option>
        <option value="kadikoy">Kadıköy</option>
        <option value="maltepe">Maltepe</option>
        <option value="umraniye">Ümraniye</option>
        <option value="cekmekoy">Çekmeköy</option>
        <option value="beykoz">Beykoz</option>
        <option value="sariyer">Sarıyer</option>
        <option value="besiktas">Beşiktaş</option>
        <option value="beyoglu">Beyoğlu</option>
        <option value="gungoren">Güngören</option>
        <option value="kagithane">Kağıthane</option>
        <option value="atasehir">Ataşehir</option>
        <option value="zeytinburnu">Zeytinburnu</option>
        <option value="fatih">Fatih</option>
      </select>

      <label>Headline</label>
      <input type="text" id="f-title" placeholder="Article headline..."/>

      <label>Summary / Lead paragraph</label>
      <textarea id="f-summary" placeholder="Short summary or opening paragraph..."></textarea>

      <label>Full Article URL (optional)</label>
      <input type="text" id="f-url" placeholder="https://..."/>

      <input type="hidden" id="f-editing-id"/>

      <div class="btn-row">
        <button class="btn btn-primary" id="submit-btn">Publish Article</button>
        <button class="btn btn-secondary" id="cancel-edit-btn" style="display:none;">Cancel Edit</button>
      </div>
      <div class="status-msg" id="form-status"></div>
    </div>

    <!-- RIGHT: Articles List -->
    <div class="panel">
      <div class="panel-title">Published Articles</div>

      <div class="filter-row">
        <select id="filter-nb">
          <option value="">All Neighborhoods</option>
          <option value="bakirkoy">Bakırköy</option>
          <option value="bayrampasa">Bayrampaşa</option>
          <option value="bahcelievler">Bahçelievler</option>
          <option value="sisli">Şişli</option>
          <option value="eyupsultan">Eyüpsultan</option>
          <option value="gop">Gaziosmanpaşa</option>
          <option value="esenler">Esenler</option>
          <option value="bagcilar">Bağcılar</option>
          <option value="basaksehir">Başakşehir</option>
          <option value="kucukcekmece">Küçükçekmece</option>
          <option value="sultangazi">Sultangazi</option>
          <option value="uskudar">Üsküdar</option>
          <option value="kadikoy">Kadıköy</option>
          <option value="maltepe">Maltepe</option>
          <option value="umraniye">Ümraniye</option>
          <option value="cekmekoy">Çekmeköy</option>
          <option value="beykoz">Beykoz</option>
          <option value="sariyer">Sarıyer</option>
          <option value="besiktas">Beşiktaş</option>
          <option value="beyoglu">Beyoğlu</option>
          <option value="gungoren">Güngören</option>
          <option value="kagithane">Kağıthane</option>
          <option value="atasehir">Ataşehir</option>
          <option value="zeytinburnu">Zeytinburnu</option>
          <option value="fatih">Fatih</option>
        </select>
        <button id="filter-btn">Filter</button>
      </div>

      <div class="articles-list" id="articles-list">
        <div class="empty-state"><span class="spinner"></span></div>
      </div>
    </div>

  </div>
</div>

<script>
// ══════════════════════════════════════════
// CONFIGURATION — Replace with your values
// ══════════════════════════════════════════
const SUPABASE_URL = 'https://fgxispjoiynnoqitwpks.supabase.co';
const SUPABASE_ANON_KEY = 'sb_publishable_iCNHaPaYLC-WRfmsfNPxYg_x2XJtI9Z';
const ADMIN_EMAIL = 'cemwozturk@gmail.com'; // e.g. 'you@youremail.com'

const { createClient } = supabase;
const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// ── Check access ──
async function checkAdmin() {
  const { data: { session } } = await sb.auth.getSession();
  if (session && session.user.email === ADMIN_EMAIL) {
    showAdminPanel(session.user);
    loadArticles();
  }
}

function showAdminPanel(user) {
  document.getElementById('access-screen').style.display = 'none';
  document.getElementById('admin-panel').style.display = 'block';
  document.getElementById('adm-email-display').textContent = user.email;
}

// ── Login ──
document.getElementById('adm-login-btn').addEventListener('click', async () => {
  const email = document.getElementById('adm-email').value.trim();
  const password = document.getElementById('adm-password').value;
  const errEl = document.getElementById('access-error');

  if (!email || !password) { errEl.textContent = 'Fill in all fields.'; return; }

  const { data, error } = await sb.auth.signInWithPassword({ email, password });

  if (error) { errEl.textContent = error.message; return; }
  if (data.user.email !== ADMIN_EMAIL) {
    await sb.auth.signOut();
    errEl.textContent = 'Access denied. Admin only.';
    return;
  }
  showAdminPanel(data.user);
  loadArticles();
});

['adm-email','adm-password'].forEach(id => {
  document.getElementById(id).addEventListener('keydown', e => {
    if (e.key === 'Enter') document.getElementById('adm-login-btn').click();
  });
});

document.getElementById('signout-btn').addEventListener('click', async () => {
  await sb.auth.signOut();
  location.reload();
});

// ── Load Articles ──
async function loadArticles(filterNb = '') {
  const listEl = document.getElementById('articles-list');
  listEl.innerHTML = '<div class="empty-state"><span class="spinner"></span></div>';

  let query = sb.from('articles').select('*').order('created_at', { ascending: false });
  if (filterNb) query = query.eq('neighborhood', filterNb);

  const { data, error } = await query;

  if (error) { listEl.innerHTML = `<div class="empty-state">Error loading articles.</div>`; return; }
  if (!data || data.length === 0) { listEl.innerHTML = '<div class="empty-state">No articles yet.</div>'; return; }

  const neighborhoodNames = {
    bakirkoy:'Bakırköy', bayrampasa:'Bayrampaşa', bahcelievler:'Bahçelievler',
    sisli:'Şişli', eyupsultan:'Eyüpsultan', gop:'Gaziosmanpaşa',
    esenler:'Esenler', bagcilar:'Bağcılar', basaksehir:'Başakşehir',
    kucukcekmece:'Küçükçekmece', sultangazi:'Sultangazi', uskudar:'Üsküdar',
    kadikoy:'Kadıköy', maltepe:'Maltepe', umraniye:'Ümraniye',
    cekmekoy:'Çekmeköy', beykoz:'Beykoz', sariyer:'Sarıyer',
    besiktas:'Beşiktaş', beyoglu:'Beyoğlu', gungoren:'Güngören',
    kagithane:'Kağıthane', atasehir:'Ataşehir', zeytinburnu:'Zeytinburnu', fatih:'Fatih'
  };

  listEl.innerHTML = data.map(a => `
    <div class="article-card" data-id="${a.id}">
      <div class="a-neighborhood">${neighborhoodNames[a.neighborhood] || a.neighborhood}</div>
      <h4>${a.title}</h4>
      ${a.summary ? `<p>${a.summary}</p>` : ''}
      <div class="card-actions">
        <button class="btn-edit" onclick="editArticle('${a.id}', '${a.neighborhood}', ${JSON.stringify(a.title).replace(/'/g,"&#39;")}, ${JSON.stringify(a.summary||'').replace(/'/g,"&#39;")}, '${a.url||''}')">Edit</button>
        <button class="btn-del" onclick="deleteArticle('${a.id}')">Delete</button>
      </div>
    </div>
  `).join('');
}

document.getElementById('filter-btn').addEventListener('click', () => {
  loadArticles(document.getElementById('filter-nb').value);
});

// ── Submit / Update ──
document.getElementById('submit-btn').addEventListener('click', async () => {
  const id = document.getElementById('f-editing-id').value;
  const neighborhood = document.getElementById('f-neighborhood').value;
  const title = document.getElementById('f-title').value.trim();
  const summary = document.getElementById('f-summary').value.trim();
  const url = document.getElementById('f-url').value.trim();
  const statusEl = document.getElementById('form-status');

  if (!neighborhood || !title) {
    statusEl.textContent = 'Please select a neighborhood and enter a headline.';
    statusEl.className = 'status-msg err';
    return;
  }

  statusEl.textContent = ''; statusEl.className = 'status-msg';
  document.getElementById('submit-btn').innerHTML = '<span class="spinner"></span>';

  let result;
  if (id) {
    result = await sb.from('articles').update({ neighborhood, title, summary, url, updated_at: new Date().toISOString() }).eq('id', id);
  } else {
    result = await sb.from('articles').insert([{ neighborhood, title, summary, url }]);
  }

  document.getElementById('submit-btn').textContent = id ? 'Update Article' : 'Publish Article';

  if (result.error) {
    statusEl.textContent = result.error.message;
    statusEl.className = 'status-msg err';
  } else {
    statusEl.textContent = id ? 'Article updated!' : 'Article published!';
    statusEl.className = 'status-msg ok';
    resetForm();
    loadArticles(document.getElementById('filter-nb').value);
    setTimeout(() => { statusEl.textContent = ''; }, 3000);
  }
});

function resetForm() {
  document.getElementById('f-editing-id').value = '';
  document.getElementById('f-neighborhood').value = '';
  document.getElementById('f-title').value = '';
  document.getElementById('f-summary').value = '';
  document.getElementById('f-url').value = '';
  document.getElementById('submit-btn').textContent = 'Publish Article';
  document.getElementById('form-mode-label').textContent = 'Add New Article';
  document.getElementById('cancel-edit-btn').style.display = 'none';
}

document.getElementById('cancel-edit-btn').addEventListener('click', resetForm);

function editArticle(id, neighborhood, title, summary, url) {
  document.getElementById('f-editing-id').value = id;
  document.getElementById('f-neighborhood').value = neighborhood;
  document.getElementById('f-title').value = title;
  document.getElementById('f-summary').value = summary;
  document.getElementById('f-url').value = url;
  document.getElementById('submit-btn').textContent = 'Update Article';
  document.getElementById('form-mode-label').textContent = 'Editing Article';
  document.getElementById('cancel-edit-btn').style.display = 'inline-block';
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

async function deleteArticle(id) {
  if (!confirm('Delete this article? This cannot be undone.')) return;
  const { error } = await sb.from('articles').delete().eq('id', id);
  if (error) { alert('Error deleting: ' + error.message); return; }
  loadArticles(document.getElementById('filter-nb').value);
}

checkAdmin();
</script>
</body>
</html>
